CREATE PROCEDURE [geometry].[sprTestSortPoints]
	@Valid BIT OUTPUT
AS
BEGIN

	-----------------------------------------------------------------------------------
	DECLARE @assertPoints TABLE (
		RowIndex INT PRIMARY KEY, -- force sql to preserve the row order!
		x DECIMAL(38,24) NOT NULL,
		y DECIMAL(38,24) NOT NULL,
		angle DECIMAL(38,24) NOT NULL
	)
	
	INSERT INTO @assertPoints
		(RowIndex, x, y, angle)
	SELECT 1	, 11.366700000000000000000000,	48.816700000000000000000000,	374.056453618591950000000000
	UNION SELECT 2	, 11.300000000000000000000000,	48.800000000000000000000000,	374.056453618591950000000000
	UNION SELECT 3	, 11.416700000000000000000000,	48.833300000000000000000000,	375.249831651350520000000000
	UNION SELECT 4	, 11.316700000000000000000000,	48.816700000000000000000000,	381.825095214441490000000000
	UNION SELECT 5	, 11.373385000000000000000000,	48.872829000000000000000000,	392.582842421694350000000000
	UNION SELECT 6	, 11.316700000000000000000000,	48.850000000000000000000000,	398.651429228189840000000000
	UNION SELECT 7	, 11.300000000000000000000000,	48.916700000000000000000000,	423.434948822921630000000000
	UNION SELECT 8	, 11.233300000000000000000000,	48.800000000000000000000000,	449.999999999999490000000000
	UNION SELECT 9	, 11.216700000000000000000000,	49.000000000000000000000000,	454.380507874729690000000000
	UNION SELECT 10	, 11.200000000000000000000000,	48.950000000000000000000000,	461.296712405146480000000000
	UNION SELECT 11	, 11.216700000000000000000000,	48.833300000000000000000000,	468.366166407568360000000000
	UNION SELECT 12	, 11.198945000000000000000000,	48.886360000000000000000000,	468.435782737653650000000000
	UNION SELECT 13	, 11.184313000000000000000000,	48.890609000000000000000000,	474.536892804804840000000000
	UNION SELECT 14	, 11.100000000000000000000000,	48.900000000000000000000000,	498.798863296518960000000000
	UNION SELECT 15	, 11.066700000000000000000000,	48.866700000000000000000000,	513.407442449847960000000000
	UNION SELECT 16	, 10.990565000000000000000000,	48.893175000000000000000000,	515.645918505548370000000000
	UNION SELECT 17	, 11.000000000000000000000000,	48.883300000000000000000000,	516.798445553835220000000000
	UNION SELECT 18	, 11.006020000000000000000000,	48.869460000000000000000000,	519.238689373502100000000000
	UNION SELECT 19	, 11.100000000000000000000000,	48.800000000000000000000000,	532.859113709804320000000000
	-----------------------------------------------------------------------------------


	-----------------------------------------------------------------------------------
	DECLARE @samplePoints AS [geometry].[Point];

	INSERT INTO @samplePoints
		(x, y)
		SELECT 11.3					, 48.8		
        UNION SELECT 11.3667				, 48.8167	
        UNION SELECT 11.4167				, 48.8333	
        UNION SELECT 11.3167				, 48.8167	
        UNION SELECT 11.373385				, 48.872829	
        UNION SELECT 11.3167				, 48.85		
        UNION SELECT 11.3					, 48.9167	
        UNION SELECT 11.2333				, 48.8		
        UNION SELECT 11.2167				, 49		
        UNION SELECT 11.2					, 48.95		
        UNION SELECT 11.2167				, 48.8333	
        UNION SELECT 11.198945				, 48.88636	
        UNION SELECT 11.184313				, 48.890609	
        UNION SELECT 11.1					, 48.9		
        UNION SELECT 11.0667				, 48.8667	
        UNION SELECT 10.990565				, 48.893175	
        UNION SELECT 11						, 48.8833	
        UNION SELECT 11.00602				, 48.86946	
        UNION SELECT 11.1					, 48.8
	-----------------------------------------------------------------------------------


	-----------------------------------------------------------------------------------
	DECLARE @sortedPoints TABLE (
		RowIndex INT IDENTITY(1,1) PRIMARY KEY, -- force sql to preserve the row order!
		x DECIMAL(38,24) NOT NULL,
		y DECIMAL(38,24) NOT NULL,
		angle DECIMAL(38,24) NOT NULL
	)

	INSERT INTO @sortedPoints
	SELECT x, y, angle FROM [geometry].[fncSortPoints](@samplePoints, 11.2333,  48.7833);
	-----------------------------------------------------------------------------------

	IF NOT ((SELECT CHECKSUM_AGG(BINARY_CHECKSUM(*)) FROM @sortedPoints) = (SELECT   CHECKSUM_AGG(BINARY_CHECKSUM(*)) FROM @assertPoints))
	BEGIN
		SET @Valid = 0
	END
END
